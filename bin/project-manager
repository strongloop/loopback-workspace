#!/usr/bin/env node
try {
  var optimist = require('optimist');
} catch (e) {
  console.error('Missing optional dependency, Optimist. To fix, please re-install.');
  console.error('Otherwise, Asteroid Project Manager can only be used as a library.');
  process.exit(1);
}

var argv = optimist.options({
    port: {
      description: 'The port number to listen on.',
      'default': 3000
    },
    root: {
      description: 'The root directory for projects.',
      'default': process.cwd()
    },
    help: {
      description: 'Show this help message, then exit.'
    }
  })
  .argv;

if (argv.help) {
  optimist.showHelp();
  process.exit();
}

var server = require('../lib/server').createServer(argv);

server.start(function (err) {
  if (err) {
    console.error('Failed to listen on port %s with:', server.port);
    console.error(err.stack || err.message || err);
    process.exit(2);
  }

  console.log('Listening on port %s...', server.port);
});
